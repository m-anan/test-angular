<div class="grid grid-cols-2 gap-6 p-5">
  <!-- LEFT: Tier Details -->
  <div>
    <h3 class="font-semibold mb-2">Tier Details</h3>

    <app-form-input
      placeholder="Tier Name"
      [maxLength]="50"
      [required]="true"
      [model]="tier.name"
      (modelChange)="onTierPropertyChange('name', $event)"
      [counterInside]="true"
    />

    <div class="mb-6">
      <div class="flex items-center justify-between mb-3">
        <h3 class="font-medium">Offering Display Name</h3>

        <label class="flex items-center gap-2 text-sm" [for]="componentId + '-override-checkbox'">
          <input
            [id]="componentId + '-override-checkbox'"
            type="checkbox"
            [checked]="useDisplayNameOverride"
            (change)="onDisplayNameOverrideCheckboxChange($event)"
            aria-label="Enable custom display name override"
          />
          Overwrite
        </label>
      </div>

      <!-- Read-only name from Step 2 -->
      @if (!useDisplayNameOverride) {
      <input
        [id]="componentId + '-display-name-readonly'"
        class="border p-2 w-full bg-gray-100 text-gray-600"
        [value]="offeringName"
        placeholder="[Name of offering added on step 2]"
        disabled
        aria-label="Offering display name from step 2"
      />
      }

      <!-- Editable override -->
      @if (useDisplayNameOverride) {
      <input
        [id]="componentId + '-display-name-override'"
        class="border p-2 w-full"
        placeholder="Enter custom display name"
        [value]="displayNameOverride"
        (input)="onDisplayNameOverrideInputChange($event)"
        aria-label="Custom display name"
      />
      }
    </div>

    <!-- Bullet Points -->
    @for (bullet of tier.bullets; track $index; let i = $index) {
    <input
      [id]="componentId + '-bullet-' + i"
      class="border p-2 w-full mb-1"
      [value]="bullet"
      (input)="onBulletChange(i, $event)"
      [placeholder]="'Bullet point ' + (i + 1)"
      [attr.aria-label]="'Bullet point ' + (i + 1)"
    />
    }

    <button
      type="button"
      class="text-[#FC5450] border rounded-full border-[#FC5450] p-2 px-6 mt-2"
      (click)="onAddBullet()"
      aria-label="Add bullet point"
    >
      Add Bullet Point
    </button>
  </div>

  <!-- RIGHT: Tier Pricing -->
  <div>
    <h3 class="font-semibold mb-2">Tier Pricing</h3>

    <!-- Billing Type Dropdown (Service Only) -->
    @if (showBillingTypeDropdown) {
    <div class="mb-3">
      <label class="block text-sm font-medium mb-1" [for]="componentId + '-billing-type'"
        >Main Billing Type</label
      >
      <select
        [id]="componentId + '-billing-type'"
        class="border p-2 w-full rounded"
        [value]="tier.billingType"
        (change)="onSelectChange('billingType', $event)"
        aria-label="Select billing type"
      >
        <option value="project">Per Project</option>
        <option value="hourly">Hourly</option>
        <option value="monthly">Monthly Retainer</option>
      </select>
    </div>
    }

    <!-- Price Range Toggle (Service Only) -->
    @if (showPriceRangeToggle && !tier.requestQuoteOnly) {
    <label class="flex items-center gap-2 mb-3" [for]="componentId + '-price-range-checkbox'">
      <input
        [id]="componentId + '-price-range-checkbox'"
        type="checkbox"
        [checked]="tier.usePriceRange"
        (change)="onCheckboxChange('usePriceRange', $event)"
        aria-label="Enable price range"
      />
      <span class="text-sm">Price Range</span>
    </label>
    }

    <!-- Pricing Inputs -->
    @if (!tier.requestQuoteOnly) {
    <!-- Service with Price Range -->
    @if (isService && tier.usePriceRange) {
    <div class="flex gap-2 mb-3">
      <div class="flex-1">
        <label class="block text-sm mb-1" [for]="componentId + '-min-price'">Min Price</label>
        <input
          [id]="componentId + '-min-price'"
          type="number"
          class="border p-2 w-full rounded"
          placeholder="Min"
          [value]="tier.minPrice"
          (input)="onNumberInputChange('minPrice', $event)"
          aria-label="Minimum price"
        />
      </div>
      <div class="flex-1">
        <label class="block text-sm mb-1" [for]="componentId + '-max-price'">Max Price</label>
        <input
          [id]="componentId + '-max-price'"
          type="number"
          class="border p-2 w-full rounded"
          placeholder="Max"
          [value]="tier.maxPrice"
          (input)="onNumberInputChange('maxPrice', $event)"
          aria-label="Maximum price"
        />
      </div>
    </div>
    }

    <!-- Fixed Price (Service without range, Product, Subscription) -->
    @if (!isService || !tier.usePriceRange) {
    <div class="mb-3">
      <label class="block text-sm mb-1" [for]="componentId + '-price'">Price</label>
      <input
        [id]="componentId + '-price'"
        type="number"
        class="border p-2 w-full rounded"
        placeholder="Enter price"
        [value]="tier.price"
        (input)="onNumberInputChange('price', $event)"
        aria-label="Price"
      />
    </div>
    }

    <!-- Monthly Duration (Service - Monthly Retainer Only) -->
    @if (showMonthlyDuration) {
    <div class="mb-3">
      <label class="block text-sm mb-1" [for]="componentId + '-monthly-duration'"
        >Number of Months</label
      >
      <select
        [id]="componentId + '-monthly-duration'"
        class="border p-2 w-full rounded"
        [value]="tier.monthlyDuration || 1"
        (change)="onSelectNumberChange('monthlyDuration', $event)"
        aria-label="Select number of months"
      >
        @for (month of monthOptions; track month) {
        <option [value]="month">{{ month }} month{{ month > 1 ? 's' : '' }}</option>
        }
      </select>
    </div>
    }

    <!-- Yearly Discount (Subscription Only) -->
    @if (showYearlyDiscount) {
    <div class="mb-3">
      <label class="flex items-center gap-2 mb-2" [for]="componentId + '-yearly-discount-checkbox'">
        <input
          [id]="componentId + '-yearly-discount-checkbox'"
          type="checkbox"
          [checked]="tier.enableYearlyDiscount"
          (change)="onCheckboxChange('enableYearlyDiscount', $event)"
          aria-label="Enable yearly discount"
        />
        <span class="text-sm font-medium">Enable Yearly Discount</span>
      </label>

      @if (tier.enableYearlyDiscount) {
      <div class="ml-6">
        <label class="block text-sm mb-1" [for]="componentId + '-discount-percent'"
          >Discount Percentage</label
        >
        <select
          [id]="componentId + '-discount-percent'"
          class="border p-2 w-full rounded mb-2"
          [value]="tier.yearlyDiscountPercent || 10"
          (change)="onSelectNumberChange('yearlyDiscountPercent', $event)"
          aria-label="Select discount percentage"
        >
          @for (discount of discountOptions; track discount) {
          <option [value]="discount">{{ discount }}%</option>
          }
        </select>

        @if (tier.price && tier.yearlyDiscountPercent) {
        <div class="text-sm text-green-600 font-medium" aria-live="polite">
          User Pays: ${{ calculatedYearlyPrice.toFixed(2) }}/year
        </div>
        }
      </div>
      }
    </div>
    } }

    <!-- Request Quote Only -->
    <label class="flex items-center gap-2 mt-3" [for]="componentId + '-quote-only-checkbox'">
      <input
        [id]="componentId + '-quote-only-checkbox'"
        type="checkbox"
        [checked]="tier.requestQuoteOnly"
        (change)="onCheckboxChange('requestQuoteOnly', $event)"
        aria-label="Request quote only"
      />
      <span class="text-sm">Request Quote Only</span>
    </label>
  </div>
</div>

<!-- Footer -->
<div class="flex justify-between mt-4 p-5 border-t border-[#F2F5F9]">
  <label class="flex items-center gap-2" [for]="componentId + '-popular-checkbox'">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="16"
      height="16"
      viewBox="0 0 22 22"
      fill="#5B5B5B"
      class=""
    >
      <path
        d="M19.8947 6.85592L16.9567 3.73168C16.552 3.30133 15.9798 3.05432 15.3865 3.05432H6.61375C6.02049 3.05432 5.44824 3.30133 5.04357 3.73168L2.10559 6.85592C2.10559 6.85592 2.10498 6.85653 2.10437 6.85653C1.39597 7.61272 1.33327 8.76088 1.95574 9.58747L9.28015 19.3116C9.68899 19.8546 10.315 20.1668 10.9984 20.1668H10.9996C11.6829 20.1668 12.3102 19.8552 12.7201 19.3116L20.0445 9.58747C20.6676 8.75978 20.6049 7.61089 19.8947 6.85592ZM15.388 10.4522L13.5363 11.0749L12.9191 12.9395C12.8176 13.2412 12.5377 13.4444 12.2224 13.4444C11.9071 13.4444 11.626 13.2412 11.5257 12.9395L10.9085 11.0749L9.05685 10.4522C8.75729 10.3526 8.55574 10.069 8.55574 9.75161C8.55574 9.4342 8.75741 9.15089 9.05685 9.05128L10.9085 8.42856L11.5257 6.56357C11.7262 5.96016 12.7174 5.96016 12.9179 6.56357L13.5351 8.42856L15.3867 9.05128C15.6862 9.15211 15.8891 9.43408 15.8891 9.75161C15.8891 10.0691 15.6874 10.3526 15.388 10.4522Z"
      ></path>
    </svg>
    Mark as Popular Choice
    <input
      [id]="componentId + '-popular-checkbox'"
      type="checkbox"
      [checked]="tier.popular"
      (change)="onCheckboxChange('popular', $event)"
      aria-label="Mark as popular choice"
    />
  </label>

  <button
    type="button"
    class="flex gap-1 text-sm items-center"
    (click)="onDeleteTier()"
    aria-label="Delete tier"
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="20" viewBox="0 0 24 24" fill="none">
      <path
        d="M5.56348 6.33343L8.65148 2.82675C9.18748 2.21342 10.1381 2.21343 10.6648 2.8401L13.6609 6.33343"
        stroke="#212121"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <path
        d="M15.5889 3.01343L18.4355 6.33341"
        stroke="#212121"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <path
        d="M18.4357 6.3335L17.7997 18.4802C17.725 19.8936 16.5544 21.0002 15.137 21.0002H8.86507C7.44641 21.0002 6.27707 19.8935 6.20241 18.4802L5.56641 6.3335H18.4357Z"
        stroke="#212121"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <path
        d="M9.83301 10.3335L10.1663 17.0002"
        stroke="#212121"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <path
        d="M14.1663 10.3335L13.833 17.0002"
        stroke="#212121"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
    Delete Tier
  </button>
</div>
